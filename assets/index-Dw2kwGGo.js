import{Z as _,v as q,_ as j,a as K,V,b as A,F as U,t as Z,A as X,C as Y,G as ee}from"./mftsccs-browser-cF0zqwBr.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();const M={baseURL:"https://boomconsole.com/api/v1",baseNodeUrl:"https://boomconsole.com"};async function b(){return new Promise(e=>{let t=localStorage?.getItem("profile")||"";if(t){const o=JSON.parse(t);e(o)}else e()})}async function te(){return new Promise(e=>{let t=localStorage?.getItem("tempwidget")||"";if(t){const o=JSON.parse(t);e(o)}else e()})}const oe=M?.baseNodeUrl;class g{static instance;static getInstance(){return g.instance||(g.instance=new g),g.instance}async getLoginInfo(){const t=await b(),o=await this.checkIfUserIsAdmin(t?.userConcept);let n="",r=!1,a=!1;if(t?.token){r=!0;let s="",i="";if(t?.entityId){let h=new _;h.typeConnection="the_entity_firstname",h.name="entity_firstname";let p=new _;p.typeConnection="the_entity_lastname",p.name="entity_lastname";let l=new _;l.typeConnection="the_entity_tour_status",l.name="entity_tour_status";let d=new _;d.type="the_entity",d.name="top",d.conceptIds=[t.entityId],d.freeschemaQueries=[h,p,l],d.outputFormat=q;let m;await j(d,"").subscribe(u=>{m=u}),s=m?.[0]?.the_entity?.the_entity_firstname?.the_firstname||"",i=m?.[0]?.the_entity?.the_entity_lastname?.the_lastname||"",a=m?.[0]?.the_entity?.the_entity_tour_status?.the_tour_status==="true"}n=`
        <div id="profileIcon" class="position-relative" onclick="headerFunctions.openUserActionModel()">
          ${t?.email?.slice(0,1)}
          <div id="profileDropdown">
            <div class="user-email">
              <span class="material-symbols-outlined">account_circle</span>
              <div class="user-info">
                <div class="full-name">${s} ${i}</div>
                <div class="email">${t?.email}</div>
              </div>
            </div>
            <!-- <router-link href="" class="dropdown-item danger" onclick="logout(event)">
              <span class="material-symbols-outlined">logout</span>
              Logout
            </router-link> -->
            <router-link class="dropdown-item danger" id="wico_btn-logout">
              <span class="material-symbols-outlined">logout</span>
              Logout
            </router-link>
          </div>
        </div>
      `}else r=!1,n=`
        <div class="d-flex flex-row gap-2">
          <!-- <router-link class="btn btn-primary" onclick="openLoginModal(event)">Login</router-link>
          <router-link class="btn btn-secondary" onclick="openSignupModal(event)">Signup</router-link> -->

          <router-link class="btn btn-primary wico_btn-openLoginModal">Login</router-link>
          <router-link class="btn btn-secondary wico_btn-openSignupModal">Signup</router-link>
        </div>
      `;return{loginInfoHTML:n,isLoggedIn:r,isAdmin:o,tourStatus:a}}async checkIfUserIsAdmin(t){try{return(await K(t))?.accessId===3}catch(o){return console.error("Error fetching user concept:",o),!1}}async logout(){const t=await te();await V(t?.id),localStorage.removeItem("profile"),localStorage.removeItem("tempwidget"),location.reload()}async checkAndUpdateToken(){try{const t=await b();if(!t?.token){console.warn("No token found in local storage.");return}const o=t.token,n=t.refreshToken,r=new Headers;r.append("Content-Type","application/json");const a={accessToken:o,refreshToken:n},i=await(await fetch(`${oe}/api/Auth/refresh`,{method:"POST",headers:r,body:JSON.stringify(a)})).json();if(i.success&&i.data){const{accessToken:h,refreshToken:p}=i.data;t.token=h,t.refreshToken=p,localStorage.removeItem("profile"),localStorage.setItem("profile",JSON.stringify(t))}else this.logout()}catch(t){console.error("Error refreshing token:",t)}}}const ne=g.getInstance();(function(){const t=window.fetch;window.fetch=async(...o)=>{const n=o[1]||{};try{const r=await t(...o);if(r.status===401){console.warn("401 Unauthorized - Refreshing token"),await ne.checkAndUpdateToken();const a=await b();if(!a?.token)return console.error("Token refresh failed. User not logged in."),r;if(n.headers){const s=new Headers(n.headers);s.set("Authorization",`Bearer ${a.token}`),s.has("Content-Type")||s.set("Content-Type","application/json"),n.headers=s}return t(o[0],n)}return r}catch(r){throw console.error("Intercepted Fetch Error:",r),r}}})();async function re(e){console.log("projectId",e);let t;if(e||(t=W()),!e&&!t?.projectId)return console.log("Project Id not found"),[];if(!e&&t.projectId&&(e=t?.projectId),console.log("projectId 2",e),!e)return[];const o=["the_item_menu_name","the_item_menu_link","the_item_menu_action","the_item_menu_auth","the_item_menu_order","the_item_menu_page"],n=new _;n.typeConnection="the_menu_s_item",n.selectors=o;function r(l,d=5){if(d==5)return;const m=new _;m.typeConnection="the_menu_s_item",m.selectors=o,l.name=d.toString(),l.freeschemaQueries=[m];const u=d+1;r(m,u)}const a=new _;a.conceptIds=[e],r(a,1);const s=await A(a,"");console.log("valllu",s);const i=s?.[0]?.the_project?.the_menu_s_item||[],h=(l=[])=>{let d=[];for(let m=0;m<l.length;m++){const u=l[m];d.push({name:u?.the_item_menu?.the_item_menu_name?.the_name??"",link:u?.the_item_menu?.the_item_menu_link?.the_link??"",action:u?.the_item_menu?.the_item_menu_action?.the_action??"",page:u?.the_item_menu?.the_item_menu_page?.the_page?Number(u?.the_item_menu?.the_item_menu_page?.the_page):"",order:u?.the_item_menu?.the_item_menu_order?.the_order?Number(u?.the_item_menu?.the_item_menu_order?.the_order):0,auth:u?.the_item_menu?.the_item_menu_auth?.the_auth=="true",menus:h(u?.the_item_menu?.the_menu_s_item)??[]})}return d.sort((m,u)=>m.order-u.order)};return h(i)}const G="wico_site";function W(){const e=atob(localStorage.getItem(G)||"");return e?JSON.parse(e):{}}function F(e,t){const o=W();o[e]=t,localStorage.setItem(G,btoa(JSON.stringify(o)))}function x(){window.wico={fetchMenus:re}}const c={PAGE_COMP_NAME:"page",WIDGET_COMP_NAME:"widget",PROJECT_COMP_NAME:"project"},ae={PROJECT_PAGE_LINKER:"s_page"};async function I(e){[{key:"meta_title",value:e?.[`the_${c.PAGE_COMP_NAME}_meta_title`]?.data?.the_meta_title},{key:"meta_description",value:e?.[`the_${c.PAGE_COMP_NAME}_meta_description`]?.data?.the_meta_description},{key:"meta_keywords",value:e?.[`the_${c.PAGE_COMP_NAME}_meta_keywords`]?.data?.the_meta_keywords},{key:"width",value:e?.[`the_${c.PAGE_COMP_NAME}_width`]?.data?.the_width},{key:"font_size",value:e?.[`the_${c.PAGE_COMP_NAME}_font_size`]?.data?.the_font_size},{key:"font_family",value:e?.[`the_${c.PAGE_COMP_NAME}_font_family`]?.data?.the_font_family},{key:"type",value:e?.[`the_${c.PAGE_COMP_NAME}_type`]?.data?.the_type}].forEach(o=>{o.value&&se(o.key,o.value)})}async function se(e,t){const o=document.getElementById("fspage-properties")||ie();let n="";switch(e){case"width":y(".fspage { width: [^;]+ !important; }"),n=t?`.fspage { width: ${t} !important; }`:"";break;case"font_size":y(".fspage { font-size: [^;]+; }"),n=t?`.fspage { font-size: ${t}px; }`:"";break;case"font_family":y(".fspage { font-family: [^;]+; }"),n=t?`.fspage { font-family: ${t}; }`:"";break;case"type":y(".fspage { width: 1200px; margin: 0 auto; }"),y(".fspage { width: 100%; padding: 0; }"),t==="fixed"?n=".fspage { width: 1200px; margin: 0 auto; }":t==="fluid"?n=".fspage { width: 100%; padding: 0; }":n="";break;case"meta_title":document.title=t;break;case"meta_keywords":N(e.replace("meta_",""),t);break;case"meta_description":N(e.replace("meta_",""),t);return}o.textContent+=n}function ie(){const e=document.createElement("style");return e.id="fspage-properties",document.head.appendChild(e),e}function N(e,t){let o=document.querySelector(`meta[name="${e}"]`);o||(o=document.createElement("meta"),o.setAttribute("name",e),document.head.appendChild(o)),o.setAttribute("content",t)}function y(e){const t=document.getElementById("fspage-properties");if(!t)return;let o=t?.textContent;o=o?o.replace(new RegExp(e,"g"),""):"",t.textContent=o}let f=[],k,P="",O=!1,L="";const E="storeOwner",C=async e=>{pe(e),await Promise.all([fe(e),ue(e)]),F("projectId",e),x(),D()},ce=async e=>{document.title=e.storeName||"Store",B(e.storeLogo),k=e.mainPageId,P=e.projectName,f=e.pagesList,localStorage.setItem(E,btoa(e.entityId)),F("projectId",e.projectId),x(),D()},D=()=>{window.addEventListener("popstate",()=>S(window.location.href)),document.addEventListener("click",e=>{const o=e.target.closest("a");if(!o||o.target==="_blank"||o.hasAttribute("download")||o.getAttribute("rel")==="external"||e.defaultPrevented||e.button!==0||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||o.origin!==location.origin)return;const n=o.getAttribute("href");!n||n.startsWith("#")||n.startsWith("mailto:")||(e.preventDefault(),history.pushState({},"",n),S(n))},!0),S(window.location.href)},S=async e=>{const{pathname:t}=new URL(e,window.location.origin);if(L==t)return;L=t;const o=he(t),n=le(e),r=document.head.querySelectorAll("style#mystyleid");if(console.log("abc",t,f,o),o){const a=f.find(s=>s.path==o.route);R(a,{params:o?.params,queryParams:n}).then(async()=>{Array.from(r).forEach(i=>i.remove());const s=await $(a?.id);I(s?.data?.[`the_${c.PAGE_COMP_NAME}`])}).catch(s=>{console.error("Error during page route chain:",s)})}else if(t==="/"&&k){const a=f.find(s=>s.id==k);R(a,{params:{},queryParams:n}).then(async()=>{Array.from(r).forEach(i=>i.remove());const s=await $(a?.id);I(s?.data?.[`the_${c.PAGE_COMP_NAME}`])}).catch(s=>{console.error("Error during page route chain:",s)})}else{const a=f.find(s=>s.path=="/404");a?z(a.page):document.querySelector("#app").innerHTML=`
      <div class="not-found-container">
        <h1>404</h1>
        <h2>Page Not Found</h2>
        <p>Sorry, the page you are looking for does not exist.</p>
        <a href="/" class="button">Go to Home Page</a>
      </div>
    `,Array.from(r).forEach(s=>s.remove())}document.getElementById("global-loader")?.classList.add("d-none")},R=async(e,t)=>{de(e),e.page?await z(e,t):console.warn("No page content Found")};function le(e){const{searchParams:t}=new URL(e,window.location.origin),o={};for(const[n,r]of t.entries())o[n]?o[n]=Array.isArray(o[n])?[...o[n],r]:[o[n],r]:o[n]=r;return o}const he=e=>{const n=[...f.map(r=>r.path)].sort((r,a)=>{const s=r.split("/").filter(Boolean),i=a.split("/").filter(Boolean),h=s.filter(l=>l.startsWith(":")).length,p=i.filter(l=>l.startsWith(":")).length;return h!==p?h-p:i.length-s.length});console.log("routes",n);for(let r=0;r<n.length;r++){const s=(n[r]?.startsWith("/")?n[r]:`/${n[r]}`).split("/").filter(Boolean),i=e.split("/").filter(Boolean);if(s.length!==i.length)continue;const h={};if(s.every((l,d)=>l.startsWith(":")?(h[l.slice(1)]=i[d],!0):l===i[d]))return{route:n[r],params:h}}return null},z=async(e,t)=>{const o=document.querySelector("#app");o&&await X(e?.page,o,t)};async function $(e){return new Promise(async t=>{let o=new _;o.conceptIds=[e],o.outputFormat=U,o.selectors=[`the_${c.PAGE_COMP_NAME}_title`,`the_${c.PAGE_COMP_NAME}_slug`,`the_${c.PAGE_COMP_NAME}_meta_title`,`the_${c.PAGE_COMP_NAME}_meta_description`,`the_${c.PAGE_COMP_NAME}_meta_keywords`,`the_${c.PAGE_COMP_NAME}_width`,`the_${c.PAGE_COMP_NAME}_type`,`the_${c.PAGE_COMP_NAME}_font_family`,`the_${c.PAGE_COMP_NAME}_font_size`,`the_${c.PAGE_COMP_NAME}_body`,`the_${c.WIDGET_COMP_NAME}_clean`],o.inpage=100,j(o,"").subscribe(async n=>{n.length?t(n?.[0]):!Array.isArray(n)&&n?.data==null&&t({error:!0,message:"There is no data."})}).catch(n=>{const r=n?.message;t({error:!0,message:r})})})}const de=e=>{if(O)return;const t=new URL(window.location.href).hostname.split(".")[0].split("-")[1],o=me(t,e),n=new Blob([JSON.stringify(o)],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("link");a.rel="manifest",a.href=r,document.head.appendChild(a),O=!0};function me(e,t){let o="/icons/icon-192x192.png",n="/icons/iicon-512x512.png",a=window.location.hostname;return a.startsWith("www.")&&(a=a.substring(4)),a==="sleepinghats.com"&&(o="/icons/sleepinghats/icon-192x192.png",n="/icons/sleepinghats/icon-152x152.png"),{name:`${P||t.title||t.slug||e} - ${e}`,short_name:`${P||e}`,start_url:location.origin+"/index.html",display:"standalone",theme_color:e?"#ff6600":"#ffffff",icons:[{src:`${location.origin}${o}`,sizes:"192x192",type:"image/png"},{src:`${location.origin}${n}`,sizes:"512x512",type:"image/png"}]}}const ue=async e=>{try{localStorage.removeItem(E);const t=new _;t.name="entity",t.typeConnection="the_entity_s_project",t.reverse=!0;const o=new _;o.name="project",o.conceptIds=[e],o.freeschemaQueries=[t],o.outputFormat=Z;const n=await A(o,"");if(!n?.[0]?.the_project?.the_entity_s_project_reverse?.[0]?.id)return;n?.[0]?.the_project?.the_entity_s_project_reverse?.length==1&&localStorage.setItem(E,btoa(n[0].the_project.the_entity_s_project_reverse[0].id.toString()));for(let r=0;r<n?.[0]?.the_project?.the_entity_s_project_reverse?.length;r++)(n?.[0]?.the_project?.the_entity_s_project_reverse[r]).id!=102176333&&localStorage.setItem(E,btoa(n[0].the_project.the_entity_s_project_reverse[0].id.toString()))}catch(t){console.error(t)}};async function pe(e){try{const t=new _;t.name="store",t.typeConnection="the_project_refers",t.selectors=["the_store_name","the_store_logo"];const o=new _;o.name="project",o.conceptIds=[e],o.freeschemaQueries=[t];const r=(await A(o,""))?.[0]?.the_project?.the_project_refers?.the_store,a=r?.the_store_name?.the_name;document.title=a||"Store",B(r?.the_store_logo?.the_logo)}catch(t){console.error(t)}}function _e(e){return new Promise((t,o)=>{const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=()=>{const a=document.createElement("canvas");a.width=a.height=512;const s=a.getContext("2d");s?.clearRect(0,0,a.width,a.height);const i=n.width/n.height;let h=512,p=512;i>1?p=512/i:h=512*i;const l=(512-h)/2,d=(512-p)/2;s?.drawImage(n,l,d,h,p);const m=a.toDataURL("image/png");t(m)},n.onerror=()=>{o(new Error("Image failed to load. Check CORS."))}})}async function fe(e){const o=(await b())?.token;let n=new _;n.name="page",n.typeConnection=`the_${c.PROJECT_COMP_NAME}_${ae.PROJECT_PAGE_LINKER}`,n.selectors=[`the_${c.PAGE_COMP_NAME}_title`,`the_${c.PAGE_COMP_NAME}_slug`,`the_${c.PAGE_COMP_NAME}_body`];let r=new _;r.name="project",r.conceptIds=[e],r.selectors=[`the_${c.PROJECT_COMP_NAME}_name`,`the_${c.PROJECT_COMP_NAME}_main_page`],r.freeschemaQueries=[n],r.outputFormat=U;const a=await A(r,o);let s={mainPageId:a?.[0]?.data?.the_project?.the_project_main_page?.id,name:a?.[0]?.data?.the_project?.the_project_name?.data.the_name||"",pages:a?.[0]?.data?.the_project?.the_project_s_page?.map(i=>({id:i?.id,title:i?.data?.the_page?.the_page_title?.data?.the_title||"",path:i?.data?.the_page?.the_page_slug?.data?.the_slug||"",page:i?.data?.the_page?.the_page_body?.id}))||[]};k=s.mainPageId,P=s.name,f=s.pages}function B(e=""){var t=document.querySelector("link[rel~='icon']");t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t),setTimeout(()=>t?.remove(),1e4)),e&&_e(e).then(o=>{t.href=o}).catch(o=>{console.error(o),t.href="https://www.sleepinghats.com/images/favicon/icon-64x64.png"})}async function H(){}const J=async e=>{const t=document.getElementById("global-loader");t?.classList.remove("d-none");try{history.pushState(null,"",e),await H()}finally{t?.classList.add("d-none")}},ge=()=>{const e=window.location.pathname+window.location.search;J(e)},ye=()=>{customElements.define("router-link",class extends HTMLElement{constructor(){super(),this.handleClick=this.handleClick.bind(this),this.href&&this.attachShadow({mode:"open"})}connectedCallback(){if(this.href){const e=document.createElement("a");e.href=this.href,this.forwardAttributes(e),e.setAttribute("part","link");const t=document.createElement("slot");e.appendChild(t),this.shadowRoot&&this.shadowRoot.appendChild(e),this.addEventListener("click",this.handleClick),e.href&&this.setAttribute("href",e.href)}else this.addEventListener("click",this.handleClick)}forwardAttributes(e){["target","download","rel","hreflang","type","title","tabindex","accesskey"].forEach(o=>{this.hasAttribute(o)&&e.setAttribute(o,this.getAttribute(o))})}disconnectedCallback(){this.removeEventListener("click",this.handleClick)}handleClick(e){const t=this.getAttribute("target"),o=this.getAttribute("href");t==="_blank"||e.ctrlKey||e.metaKey||e.button===1||this.hasAttribute("download")||o&&!o.startsWith("http")&&!o.startsWith("//")&&(e.preventDefault(),J(o))}set href(e){this.setAttribute("href",e);const t=this.shadowRoot&&this.shadowRoot.querySelector("a");t&&(t.href=e)}get href(){return this.getAttribute("href")}set target(e){e&&this.setAttribute("target",e)}get target(){return this.getAttribute("target")}})};function we(){ge(),ye(),window.addEventListener("popstate",H)}const Pe=async()=>{const e=["localhost","visualwidget.boomconcole.com","develop.freeschema.com"],t=window.location.hostname,o=t.split(".")?.[0]?.match(/preview-(\d+)/)?.[1];if(o)C(parseInt(o));else if(e.includes(t))we();else try{be(t)}catch(n){console.error(n),v()}};function v(){const e=document.getElementById("global-loader");e&&e.setAttribute("style","display: none !important");const t=document.getElementById("app");t&&(t.innerHTML=`
    <div class="not-found-container">
      <h1>404</h1>
      <h2>Page Not Found</h2>
      <p>Sorry, the page you are looking for does not exist.</p>
      <a href="/" class="button">Go to Home Page</a>
    </div>
  `)}function be(e=""){try{const t=JSON.parse(sessionStorage.getItem("cacheServers")??"[]")||[],o=t.length>0&&t?.[0]!="https://boomconsole.com"?t[0]:"https://deploy.freeschema.com",n=new URLSearchParams;n.append("url",e),console.log("server",o),fetch(o+"/api/project-deploy",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}).then(async r=>{const a=await r.json();ce(a.data)}).catch(r=>{console.error(r),T(e);try{const s=JSON.parse(sessionStorage.getItem("domainRecord")??"{}");if(s&&s.expiresAt>Date.now()){const i=s.value;i&&C(parseInt(i));return}}catch(a){console.error(a),v()}})}catch(t){console.error(t),T(e)}}function T(e=""){const t=new URLSearchParams;t.append("url",e),fetch(M.baseURL+"/dns/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(async o=>{const n=await o.json();if(!n)Ee();else{const r=n?.startsWith("http")?n:"http://"+n,s=new URL(r).hostname?.split(".")?.[0]?.match(/preview-(\d+)/)?.[1];if(s)C(parseInt(s));else throw new Error("Path Not Valid")}}).catch(o=>{console.error(o),v()})}function Ee(){fetch(M.baseURL+"/cname").then(async e=>{const t=await e.json()||[];if(t?.[0]){const o=t[0]?.startsWith("http")?t[0]:"http://"+t[0],r=new URL(o).hostname?.split(".")?.[0]?.match(/preview-(\d+)/)?.[1];if(r)C(parseInt(r));else throw new Error("Path Not Valid")}else throw new Error("Doamin Not Found")}).catch(e=>{console.error(e),v()})}const w={baseNodeUrl:"https://boomconsole.com",boomURL:"https://boomconsole.com",aiURL:"https://www.ai.freeschema.com/api",logserver:"https://logger.freeschema.com",enableSW:!1};let Q=null;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Q=e});const ke={activate:w.enableSW,scope:"/",pathToSW:"/serviceWorker.bundle.js",manual:!0};Y(w?.boomURL,w?.aiURL,"",w?.baseNodeUrl,void 0,"widget_conceptualizer",ke,{logApplication:!0,logPackage:!1,isTest:!1,accessTracker:!1},{logserver:w.logserver});const Ae=await b();ee(Ae?.token);Pe();window.PWAInstallHandler=(()=>{let e=null,t=null,o=null;return{init:({onInstall:s,onDismiss:i})=>{t=s,o=i,e=Q,window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully!"),t&&t()})},isInstalled:()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator?.standalone,showInstallPrompt:()=>{console.log("deferedPrompt",e),e&&(e.prompt(),e.userChoice.then(s=>{s.outcome==="accepted"?(console.log("User installed the PWA."),t&&t()):(console.log("User dismissed the install prompt."),o&&o()),e=null}))}}})();
